<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medication Lookup App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      content: ['./*.{html,js}'],
      theme: { extend: {} },
      plugins: [],
    }
  </script>
</head>
<body>
  <div id="root" class="min-h-screen bg-gray-100 p-4"></div>

  <script type="text/javascript">
    const { createRoot } = ReactDOM;
    const root = createRoot(document.getElementById('root'));

    const App = () => {
      const [caData, setCaData] = React.useState(null);
      const [nonCaData, setNonCaData] = React.useState(null);
      const [selectedState, setSelectedState] = React.useState('');
      const [selectedGoal, setSelectedGoal] = React.useState('');

      const patientGoals = [
        'Men - Standard TRT Protocol',
        'Men - Standard Add On',
        'Women - Standard HRT Protocol',
        'Women - Standard Add On',
        'Joint Pain/Healing',
        'Sexual Function',
        'Vitamins',
        'Hair Loss',
        'Improve Energy',
        'Anti-Aging',
        'Improve Sleep',
        'Weight Loss'
      ];

      const states = [
        'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware',
        'District of Columbia', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa',
        'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota',
        'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico',
        'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Puerto Rico',
        'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia',
        'Washington', 'West Virginia', 'Wisconsin', 'Wyoming', 'Virgin Islands'
      ];

      const shipmentMap = {
        // Full shipmentMap as before - copy from previous messages if needed
      };

      const processAndCleanData = (rawData) => {
        return rawData.map(row => {
          const cleanedRow = {};
          Object.keys(row).forEach(key => {
            const value = row[key] != null ? String(row[key]).trim().replace(/^"|"$/g, '') : '';
            cleanedRow[key] = value;
          });
          cleanedRow['Description'] = getMedicationDescription(cleanedRow['Medication']);
          return cleanedRow;
        }).filter(row => row['Medication']);
      };

      const getMedicationDescription = (medication) => {
        // Full descriptions
      };

      React.useEffect(() => {
        // caCsvData and Papa.parse
        // nonCaCsvData and Papa.parse
      }, []);

      const data = selectedState === 'California' ? caData : nonCaData;

      const filteredMedications = React.useMemo(() => {
        if (!data || !selectedState || !selectedGoal) return [];
        const stateShipments = shipmentMap[selectedState] || {};
        const availablePharmacies = Object.keys(stateShipments).filter(pharm => stateShipments[pharm]);

        return data.filter(row => {
          let medPharm = row['Pharm.'] || 'All';
          const restrictions = row['Pharm.'] ? row['Pharm.'].match(/NO\s[A-Z]{2}/g) || [] : [];
          if (restrictions.some(rest => selectedState.toUpperCase().includes(rest.replace('NO ', '')))) return false;

          const isHCGRelated = ['Pregnyl', 'Gonadorelin', 'HCG'].some(term => row['Medication'].includes(term));
          let isAvailable = false;

          if (medPharm === 'All') {
            isAvailable = availablePharmacies.length > 0;
          } else if (isHCGRelated) {
            isAvailable = stateShipments['RiteAway'] || stateShipments['Revive'];
          } else {
            isAvailable = medPharm.split(/ \/ |, /).some(p => availablePharmacies.includes(p.trim()));
          }

          const goalMatch = getGoalForMedication(row['Medication']) === selectedGoal;
          return isAvailable && goalMatch;
        });
      }, [data, selectedState, selectedGoal]);

      const getGoalForMedication = (medication) => {
        // Full goal mapping
      };

      if (!caData || !nonCaData) {
        return React.createElement('div', { className: 'text-center text-gray-600 text-xl' }, 'Loading medication data...');
      }

      return React.createElement('div', { className: 'container mx-auto p-6 bg-white rounded-lg shadow-lg' },
        React.createElement('h1', { className: 'text-3xl font-bold mb-6 text-blue-600' }, 'Medication Lookup'),
        React.createElement('div', { className: 'flex space-x-4 mb-6' },
          React.createElement('div', { className: 'flex-1' },
            React.createElement('label', { className: 'block text-gray-700 font-semibold mb-2' }, 'Select State'),
            React.createElement('select', { value: selectedState, onChange: (e) => setSelectedState(e.target.value), className: 'w-full p-2 border rounded-md' },
              React.createElement('option', { value: '' }, 'Select a state'),
              states.map(state => React.createElement('option', { key: state, value: state }, state))
            )
          ),
          React.createElement('div', { className: 'flex-1' },
            React.createElement('label', { className: 'block text-gray-700 font-semibold mb-2' }, 'Patient Goal'),
            React.createElement('select', { value: selectedGoal, onChange: (e) => setSelectedGoal(e.target.value), className: 'w-full p-2 border rounded-md' },
              React.createElement('option', { value: '' }, 'Select a goal'),
              patientGoals.map(goal => React.createElement('option', { key: goal, value: goal }, goal))
            )
          )
        ),
        filteredMedications.length > 0 ? React.createElement('div', { className: 'overflow-x-auto' },
          React.createElement('table', { className: 'w-full table-auto border-collapse' },
            React.createElement('thead', null,
              React.createElement('tr', { className: 'bg-blue-100' },
                ['Medication', 'Syringes', 'Delivery', 'Strength', 'Quantity', 'Price', 'Duration', 'Pharmacy', 'Dosing', 'Description'].map(header => 
                  React.createElement('th', { key: header, className: 'p-3 text-left' }, header)
                )
              )
            ),
            React.createElement('tbody', null,
              filteredMedications.map((med, index) => React.createElement('tr', { key: index, className: index % 2 === 0 ? 'bg-gray-50' : 'bg-white' },
                React.createElement('td', { className: 'p-3' }, med['Medication']),
                React.createElement('td', { className: 'p-3' }, med['Syringes'] || 'N/A'),
                React.createElement('td', { className: 'p-3' }, med['Type']),
                React.createElement('td', { className: 'p-3' }, med['Strength']),
                React.createElement('td', { className: 'p-3' }, med['Quantity']),
                React.createElement('td', { className: 'p-3' }, `$${med['Price'].toFixed(2)}`),
                React.createElement('td', { className: 'p-3' }, med['Duration'] || 'N/A'),
                React.createElement('td', { className: 'p-3' }, med['Pharm.'] || 'All'),
                React.createElement('td', { className: 'p-3' }, med['Standard Dosing'] || 'N/A'),
                React.createElement('td', { className: 'p-3' }, med['Description'])
              ))
            )
          )
        ) : React.createElement('p', { className: 'text-gray-600' },
          selectedState && selectedGoal ? 'No medications available for this state and goal.' : 'Please select a state and patient goal.'
        ),
        filteredMedications.length > 0 && React.createElement('div', { className: 'mt-8' },
          React.createElement('h2', { className: 'text-2xl font-semibold mb-4 text-blue-600' }, 'Price Comparison'),
          React.createElement(Recharts.ResponsiveContainer, { width: '100%', height: 400 },
            React.createElement(Recharts.BarChart, { data: filteredMedications },
              React.createElement(Recharts.CartesianGrid, { strokeDasharray: '3 3' }),
              React.createElement(Recharts.XAxis, { dataKey: 'Medication', tick: { fontSize: 12 }, interval: 0, angle: -45, textAnchor: 'end', height: 100 }),
              React.createElement(Recharts.YAxis, { label: { value: 'Price ($)', angle: -90, position: 'insideLeft', fontSize: 12 }, tick: { fontSize: 12 } }),
              React.createElement(Recharts.Tooltip, { formatter: (value) => `$${value.toFixed(2)}` }),
              React.createElement(Recharts.Legend, null),
              React.createElement(Recharts.Bar, { dataKey: 'Price', fill: '#3b82f6' })
            )
          )
        )
      );
    };

    root.render(React.createElement(App));
  </script>
</body>
</html>
