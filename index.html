<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medication Lookup App</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f3f4f6;
      min-height: 100vh;
      padding: 1rem;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    h1 {
      font-size: 2rem;
      font-weight: bold;
      color: #1f2937;
      margin-bottom: 1.5rem;
    }
    h2 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
    }
    h3 {
      font-size: 1.125rem;
      font-weight: 600;
      color: #2563eb;
      margin-bottom: 0.5rem;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    @media (min-width: 768px) {
      .grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.5rem;
    }
    select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      font-size: 1rem;
      background-color: white;
    }
    select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    select:disabled {
      background-color: #f3f4f6;
      cursor: not-allowed;
    }
    .medication-card {
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
      transition: box-shadow 0.2s;
    }
    .medication-card:hover {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .medication-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }
    @media (min-width: 768px) {
      .medication-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    .info-box {
      padding: 0.75rem;
      border-radius: 0.375rem;
      margin-bottom: 0.75rem;
    }
    .info-box.dosing {
      background-color: #fef3c7;
    }
    .info-box.description {
      background-color: #f9fafb;
    }
    .text-muted {
      color: #6b7280;
    }
    .font-medium {
      font-weight: 500;
    }
    .alert {
      padding: 1rem;
      background-color: #e0f2fe;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }
    .warning {
      padding: 1rem;
      background-color: #fef3c7;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Medication Lookup</h1>
      
      <div id="data-status" class="alert">
        <p><strong>Status:</strong> Using Viking medication data. <span id="med-count"></span></p>
      </div>
      
      <div class="grid">
        <div>
          <label for="state-select">Select State</label>
          <select id="state-select">
            <option value="">Choose a state...</option>
          </select>
        </div>
        
        <div>
          <label for="goal-select">Select Patient Goal</label>
          <select id="goal-select" disabled>
            <option value="">Choose a goal...</option>
          </select>
        </div>
      </div>

      <p id="select-goal-message" class="text-muted hidden">Please select a patient goal to view available medications.</p>
    </div>

    <div id="results-section" class="card hidden">
      <h2 id="results-header"></h2>
      <div id="medications-list"></div>
    </div>

    <div id="no-results" class="card hidden">
      <p style="text-align: center;" class="text-muted">
        No medications available for this combination. 
        This may be due to pharmacy shipping restrictions.
      </p>
    </div>

    <div id="instructions" class="card">
      <h3>Medication Data Loaded</h3>
      <p class="text-muted">Your Viking medication data has been loaded successfully. Select a state and patient goal to view available medications.</p>
    </div>
  </div>

  <script>
    // COMPLETE VIKING MEDICATION DATA from your CSVs
    const VIKING_MEDICATIONS = [
      // Men - Standard TRT Protocol
      {
        category: 'Men - Standard TRT Protocol',
        medication: 'Testosterone Cypionate Anastrozole Tablets #10',
        syringes: '#20 IM syringes',
        delivery: 'INJECTABLE',
        strength: '200mg/ml',
        quantity: '10ml vial',
        price: '$250.00',
        duration: '10 weeks',
        pharmacy: '',
        remarksDosing: 'Inject 0.5 ml (100 mg) by intramuscular route 2x weekly. Take ¼ (0.25 mg) - ½ tablet (.5 mg) by mouth 2x weekly.',
        description: 'Testosterone Cypionate is used in hormone replacement therapy (HRT) to treat low testosterone levels in adult men to help improve mood, energy, libido, muscle mass, fat distribution, and overall quality of life.'
      },
      {
        category: 'Men - Standard TRT Protocol',
        medication: 'Testosterone Enanthate Anastrozole Tablets #10',
        syringes: '#20 IM syringes',
        delivery: 'INJECTABLE',
        strength: '200mg/ml',
        quantity: '10ml vial',
        price: '$250.00',
        duration: '10 weeks',
        pharmacy: '',
        remarksDosing: 'Inject 0.5 ml (100 mg) by intramuscular route 2x weekly. Take ¼ (0.25 mg) - ½ tablet (.5 mg) by mouth 2x weekly.',
        description: 'Alternative testosterone ester for TRT.'
      },
      {
        category: 'Men - Standard TRT Protocol',
        medication: 'Testosterone Cream 200 MG/GM (20%) Anastrozole Tablets #10',
        syringes: '',
        delivery: 'CREAM',
        strength: '200mg/g',
        quantity: '30g',
        price: '$300.00',
        duration: '8 weeks',
        pharmacy: '',
        remarksDosing: 'Up to 1 click 2x per day. Take ¼ (0.25 mg) - ½ tablet (.5 mg) by mouth 2x weekly.',
        description: 'Topical testosterone replacement therapy 30g.'
      },
      {
        category: 'Men - Standard TRT Protocol',
        medication: 'Kyzatrex 150mg Capsules',
        syringes: '',
        delivery: 'Capsule',
        strength: '150mg',
        quantity: '120ct',
        price: '$225.00',
        duration: '',
        pharmacy: 'NUBIOAGE ONLY',
        remarksDosing: 'Take 1 capsule AM and 1 capsule PM Take 2 capsules AM and 2 capsules PM',
        description: 'Oral testosterone replacement 150mg.'
      },
      
      // Men - Standard Add On
      {
        category: 'Men - Standard Add On',
        medication: 'Exemestane',
        syringes: '',
        delivery: 'Tablet',
        strength: '25mg',
        quantity: '1',
        price: '$2.00',
        duration: '',
        pharmacy: '',
        remarksDosing: 'Take ¼ (0.25 mg) - ½ tablet (.5 mg) by mouth 2x weekly.',
        description: 'Aromatase inhibitor for estrogen control.'
      },
      {
        category: 'Men - Standard Add On',
        medication: 'HCG - lyophilized (Powder)',
        syringes: '#20 Insulin syringes',
        delivery: 'Injectable',
        strength: '5000iu',
        quantity: '1 vial',
        price: '$150.00',
        duration: '10 weeks',
        pharmacy: '',
        remarksDosing: 'Inject 25 units by subcutaneous route 2x weekly. Reconstitute with 5ml bac water',
        description: 'Human Chorionic Gonadotropin for testicular function.'
      },
      {
        category: 'Men - Standard Add On',
        medication: 'Clomiphene (Clomid)',
        syringes: '',
        delivery: 'Capsule',
        strength: '25mg',
        quantity: '1',
        price: '$1.50',
        duration: '',
        pharmacy: '',
        remarksDosing: 'starting dose: 25mg po twice weekly, may work up to daily.',
        description: 'SERM for testosterone production support.'
      },

      // Women - Standard HRT Protocol
      {
        category: 'Women - Standard HRT Protocol',
        medication: 'Testosterone Cypionate',
        syringes: '#10 Insulin syringes',
        delivery: 'INJECTABLE',
        strength: '200mg/ml',
        quantity: '1ml vial',
        price: '$170.00',
        duration: '10 weeks',
        pharmacy: '',
        remarksDosing: '',
        description: 'Low-dose testosterone for women.'
      },
      {
        category: 'Women - Standard HRT Protocol',
        medication: 'Bi-Estrogen Cream 0.25mg/g',
        syringes: '',
        delivery: 'TopiClick',
        strength: '0.25mg/g',
        quantity: '30g',
        price: '$150.00',
        duration: '',
        pharmacy: '',
        remarksDosing: '4 clicks - 1 gram of medication',
        description: 'Bioidentical estrogen replacement.'
      },

      // Women - Standard Add On
      {
        category: 'Women - Standard Add On',
        medication: 'Progesterone',
        syringes: '',
        delivery: 'Capsule',
        strength: '100mg',
        quantity: '1',
        price: '$1.00',
        duration: '',
        pharmacy: '',
        remarksDosing: '',
        description: 'Natural progesterone 100mg.'
      },

      // Sexual Function
      {
        category: 'Sexual Function',
        medication: 'Sildenafil (Viagra)',
        syringes: '',
        delivery: 'Tablet',
        strength: '20mg',
        quantity: '1',
        price: '$1.00',
        duration: '',
        pharmacy: '',
        remarksDosing: '',
        description: 'Low dose ED medication.'
      },
      {
        category: 'Sexual Function',
        medication: 'Tadalafil (Cialis)',
        syringes: '',
        delivery: 'Tablet',
        strength: '20mg',
        quantity: '1',
        price: '$2.00',
        duration: '',
        pharmacy: '',
        remarksDosing: '',
        description: 'As-needed ED medication.'
      },

      // Weight Loss
      {
        category: 'Weight Loss',
        medication: 'Semaglutide',
        syringes: '',
        delivery: 'Injectable',
        strength: '1.25MG',
        quantity: '4mL',
        price: '$699.99',
        duration: '',
        pharmacy: '',
        remarksDosing: 'Need Health form and Semi labs',
        description: 'GLP-1 agonist for weight loss.'
      },
      {
        category: 'Weight Loss',
        medication: 'Metformin',
        syringes: '',
        delivery: 'Tablet',
        strength: '500mg',
        quantity: '1',
        price: '$0.50',
        duration: '',
        pharmacy: '',
        remarksDosing: 'Take 1-2 capsules daily',
        description: 'Diabetes medication for weight management.'
      },

      // Hair Loss
      {
        category: 'Hair Loss',
        medication: 'Finasteride',
        syringes: '',
        delivery: 'Tablet',
        strength: '1mg',
        quantity: '1',
        price: '$1.00',
        duration: '',
        pharmacy: 'All',
        remarksDosing: 'Take 1 capsule po daily or EOD',
        description: '5α-reductase inhibitor for male pattern baldness.'
      }
    ];

    const CA_MEDICATIONS = [
      {
        category: 'Men - Standard TRT Protocol',
        medication: 'Testosterone Cypionate Anastrozole Tablets #10',
        syringes: '#20 IM syringes',
        delivery: 'INJECTABLE',
        strength: '200mg/ml',
        quantity: '10ml vial',
        price: '$275.00',
        duration: '10 weeks',
        pharmacy: 'ScriptWorks',
        remarksDosing: 'Inject 0.5 ml (100 mg) by intramuscular route 2x weekly. Take ¼ (0.25 mg) - ½ tablet (.5 mg) by mouth 2x weekly.',
        description: 'California-specific testosterone formulation.'
      }
    ];

    // Data constants
    const STATES = [
      'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware',
      'District of Columbia', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa',
      'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota',
      'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico',
      'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Puerto Rico',
      'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia',
      'Washington', 'West Virginia', 'Wisconsin', 'Wyoming', 'Virgin Islands'
    ];

    const PATIENT_GOALS = [
      'Men - Standard TRT Protocol',
      'Men - Standard Add On',
      'Women - Standard HRT Protocol',
      'Women - Standard Add On',
      'Joint Pain/Healing',
      'Sexual Function',
      'Vitamins',
      'Hair Loss',
      'Improve Energy',
      'Anti-Aging',
      'Improve Sleep',
      'Weight Loss'
    ];

    const SHIPMENT_MAP = {
      'Alabama': { Hallandale: false, 'First Choice': true, RiteAway: false, Revive: false, NuBioage: false, ScriptWorks: false },
      'Alaska': { Hallandale: false, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: false, ScriptWorks: false },
      'Arizona': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Arkansas': { Hallandale: false, 'First Choice': true, RiteAway: false, Revive: false, NuBioage: false, ScriptWorks: false },
      'California': { Hallandale: false, 'First Choice': false, RiteAway: false, Revive: false, NuBioage: false, ScriptWorks: true },
      'Colorado': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: false, NuBioage: true, ScriptWorks: false },
      'Connecticut': { Hallandale: false, 'First Choice': true, RiteAway: true, Revive: false, NuBioage: true, ScriptWorks: false },
      'Delaware': { Hallandale: true, 'First Choice': false, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'District of Columbia': { Hallandale: true, 'First Choice': false, RiteAway: true, Revive: false, NuBioage: true, ScriptWorks: false },
      'Florida': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Georgia': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Hawaii': { Hallandale: false, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Idaho': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Illinois': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Indiana': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Iowa': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: false, NuBioage: false, ScriptWorks: false },
      'Kansas': { Hallandale: false, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Kentucky': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: false, NuBioage: true, ScriptWorks: false },
      'Louisiana': { Hallandale: true, 'First Choice': false, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Maine': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: false, ScriptWorks: false },
      'Maryland': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Massachusetts': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: false, NuBioage: true, ScriptWorks: false },
      'Michigan': { Hallandale: false, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Minnesota': { Hallandale: false, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Mississippi': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: false, NuBioage: false, ScriptWorks: false },
      'Missouri': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Montana': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Nebraska': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Nevada': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'New Hampshire': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'New Jersey': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'New Mexico': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'New York': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'North Carolina': { Hallandale: true, 'First Choice': false, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'North Dakota': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Ohio': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Oklahoma': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Oregon': { Hallandale: false, 'First Choice': true, RiteAway: false, Revive: true, NuBioage: true, ScriptWorks: false },
      'Pennsylvania': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Puerto Rico': { Hallandale: true, 'First Choice': false, RiteAway: false, Revive: false, NuBioage: true, ScriptWorks: false },
      'Rhode Island': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'South Carolina': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: false, NuBioage: false, ScriptWorks: false },
      'South Dakota': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Tennessee': { Hallandale: false, 'First Choice': false, RiteAway: false, Revive: false, NuBioage: false, ScriptWorks: false },
      'Texas': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Utah': { Hallandale: true, 'First Choice': false, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Vermont': { Hallandale: true, 'First Choice': true, RiteAway: false, Revive: false, NuBioage: true, ScriptWorks: false },
      'Virginia': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Washington': { Hallandale: true, 'First Choice': false, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'West Virginia': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Wisconsin': { Hallandale: true, 'First Choice': true, RiteAway: true, Revive: true, NuBioage: true, ScriptWorks: false },
      'Wyoming': { Hallandale: true, 'First Choice': false, RiteAway: true, Revive: false, NuBioage: false, ScriptWorks: false },
      'Virgin Islands': { Hallandale: false, 'First Choice': false, RiteAway: false, Revive: false, NuBioage: false, ScriptWorks: false }
    };

    // Use your actual data
    let medications = VIKING_MEDICATIONS;
    let caMedications = CA_MEDICATIONS;

    // Filter medications
    function filterMedications(state, goal) {
      console.log(`Filtering for state: ${state}, goal: ${goal}`);
      
      const medList = state === 'California' ? caMedications : medications;
      console.log(`Using ${state === 'California' ? 'CA' : 'regular'} medications, count: ${medList.length}`);
      
      let filtered = medList.filter(med => med.category === goal);
      console.log(`After category filter: ${filtered.length} medications`);
      
      if (state !== 'California') {
        const stateShipping = SHIPMENT_MAP[state] || {};
        
        filtered = filtered.filter(med => {
          if (!med.pharmacy || med.pharmacy === 'null' || med.pharmacy.trim() === '') {
            return Object.values(stateShipping).some(ships => ships);
          }
          
          const pharmacies = med.pharmacy.split(',').map(p => p.trim());
          
          if (med.medication.toLowerCase().includes('hcg') || 
              med.medication.toLowerCase().includes('pregnyl') ||
              med.medication.toLowerCase().includes('gonadorelin')) {
            return stateShipping['RiteAway'] || stateShipping['Revive'];
          }
          
          return pharmacies.some(pharmacy => {
            if (pharmacy.includes('Hallandale')) return stateShipping['Hallandale'];
            if (pharmacy.includes('First Choice') || pharmacy.includes('1st Choice')) return stateShipping['First Choice'];
            if (pharmacy.includes('Rite Away') || pharmacy.includes('RiteAway')) return stateShipping['RiteAway'];
            if (pharmacy.includes('Revive')) return stateShipping['Revive'];
            if (pharmacy.includes('NuBioage') || pharmacy.includes('NuBiage')) return stateShipping['NuBioage'];
            return true;
          });
        });
        
        console.log(`After shipping filter: ${filtered.length} medications`);
      }
      
      return filtered;
    }

    // Display medications
    function displayMedications(meds, state, goal) {
      const resultsSection = document.getElementById('results-section');
      const noResults = document.getElementById('no-results');
      const header = document.getElementById('results-header');
      const list = document.getElementById('medications-list');
      
      if (meds.length === 0) {
        resultsSection.classList.add('hidden');
        noResults.classList.remove('hidden');
        return;
      }
      
      noResults.classList.add('hidden');
      resultsSection.classList.remove('hidden');
      
      header.textContent = `Available Medications for ${goal} in ${state}`;
      
      list.innerHTML = meds.map(med => `
        <div class="medication-card">
          <h3>${med.medication}</h3>
          
          <div class="medication-grid">
            <div>
              ${med.delivery ? `<p><span class="font-medium">Delivery:</span> ${med.delivery}</p>` : ''}
              ${med.strength ? `<p><span class="font-medium">Strength:</span> ${med.strength}</p>` : ''}
              ${med.quantity ? `<p><span class="font-medium">Quantity:</span> ${med.quantity}</p>` : ''}
              ${med.price ? `<p><span class="font-medium">Price:</span> ${med.price}</p>` : ''}
            </div>
            <div>
              ${med.duration ? `<p><span class="font-medium">Duration:</span> ${med.duration}</p>` : ''}
              ${med.syringes && med.syringes !== 'null' ? `<p><span class="font-medium">Syringes:</span> ${med.syringes}</p>` : ''}
              ${med.pharmacy && med.pharmacy !== 'null' ? `<p><span class="font-medium">Pharmacy:</span> ${med.pharmacy}</p>` : ''}
            </div>
          </div>
          
          ${med.remarksDosing && med.remarksDosing !== 'null' ? `
            <div class="info-box dosing">
              <p class="font-medium">Dosing Instructions:</p>
              <p class="text-muted">${med.remarksDosing}</p>
            </div>
          ` : ''}
          
          ${med.description ? `
            <div class="info-box description">
              <p class="font-medium">Description:</p>
              <p class="text-muted">${med.description}</p>
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    // Initialize
    function init() {
      console.log('Initializing app...');
      
      const stateSelect = document.getElementById('state-select');
      const goalSelect = document.getElementById('goal-select');
      const medCount = document.getElementById('med-count');
      
      // Update status
      const totalMeds = medications.length + caMedications.length;
      medCount.textContent = `${totalMeds} medications loaded (${medications.length} regular, ${caMedications.length} CA)`;
      
      // Populate states
      STATES.forEach(state => {
        const option = document.createElement('option');
        option.value = state;
        option.textContent = state;
        stateSelect.appendChild(option);
      });
      
      // Populate goals
      PATIENT_GOALS.forEach(goal => {
        const option = document.createElement('option');
        option.value = goal;
        option.textContent = goal;
        goalSelect.appendChild(option);
      });
      
      // State selection
      stateSelect.addEventListener('change', function() {
        console.log('State changed to:', this.value);
        const state = this.value;
        
        if (state) {
          goalSelect.disabled = false;
          document.getElementById('select-goal-message').classList.remove('hidden');
        } else {
          goalSelect.disabled = true;
          goalSelect.value = '';
          document.getElementById('select-goal-message').classList.add('hidden');
          document.getElementById('results-section').classList.add('hidden');
          document.getElementById('no-results').classList.add('hidden');
        }
        
        if (state && goalSelect.value) {
          const filtered = filterMedications(state, goalSelect.value);
          displayMedications(filtered, state, goalSelect.value);
        }
      });
      
      // Goal selection
      goalSelect.addEventListener('change', function() {
        console.log('Goal changed to:', this.value);
        const state = stateSelect.value;
        const goal = this.value;
        
        if (state && goal) {
          document.getElementById('select-goal-message').classList.add('hidden');
          const filtered = filterMedications(state, goal);
          displayMedications(filtered, state, goal);
        }
      });
      
      console.log('App initialized successfully');
    }

    // Start the app
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
